<% if (theme.rightmenu && theme.rightmenu.enable == true && theme.rightmenu.layout.length > 0) { %>
  <% function loadmenu(obj) { %>
    <li>
      <a class="vlts-menu" <%= obj.url ? 'href='+ url_for(obj.url)+'' : ''%>
        <% if (obj.rel) { %>
          rel="<%- obj.rel %>"
        <% } %>
        <% if (obj.target) { %>
          target="<%- obj.target %>"
        <% } %>
        <% if (obj.onclick) { %>
          onclick="<%- obj.onclick %>"
        <% } %>
        <% if (obj.id) { %>
          id="<%- obj.id %>"
        <% } else if (obj.url) { %>
          id="<%= url_for(obj.url).replace(/\/|%|\./g, "")?url_for(obj.url).replace(/\/|%|\./g, ""):"home" %>"
        <% } %>>
        <% if (obj.icon) { %><i class='<%= obj.icon %> fa-fw'></i><% } %> <%- obj.name %>
      </a>
      <% if (obj.rows) { %>
        <ul class="list-v" id="rightmenu-submenu">
          <% obj.rows.forEach(function(row){ %>
            <% loadmenu(row) %>
          <%})%>
        </ul>
      <% } %>
    </li>
  <% } %>

  <div id="rightmenu-wrapper" style="display: none;position:fixed;z-index: 2000;">
    <ul class="rightmenu list-v" id="rightmenu-content" style="display: block;width: 120px;">
      <% theme.rightmenu.layout.forEach(function(item){ %>
        <% if (item == 'hr') { %>
          <hr>
        <% } else if (item in theme.rightmenu) { %>
          <% loadmenu(theme.rightmenu[item]) %>
        <% } %>
      <% }) %>
    </ul>
  </div>

  <script>
    window.document.oncontextmenu = function () {
      return false;
    };
    document.addEventListener("click", function (event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      mymenu.style.display = "none";
    });
    function popMenu(event) {
      var copy = document.getElementById('menu-copy');
      var select = window.getSelection().toString(); // 鼠标选中的文本
      copy.style.display = select == "" ? "none" : "block";
      var mymenu = document.getElementById('rightmenu-wrapper');
      var menuContent = document.getElementById('rightmenu-content');
      var menuMusicCard = document.getElementById('rightmenu-submenu');
      var mouseClientX = event.clientX;
      var mouseClientY = event.clientY;
      var menuWidth = menuContent.offsetWidth == 0 ? 120 : menuContent.offsetWidth;
      var menuHeight = menuContent.offsetHeight == 0 ? 242 : menuContent.offsetHeight;
      var screenWidth = document.documentElement.clientWidth || document.body.clientWidth;
      var screenHeight = document.documentElement.clientHeight || document.body.clientHeight;
      var showLeft = mouseClientX + menuWidth > screenWidth ? mouseClientX - menuWidth + 10 : mouseClientX;
      var showTop = mouseClientY + menuHeight > screenHeight ? mouseClientY - menuHeight + 10 : mouseClientY;
      mymenu.style.left = showLeft + "px"; // 获取鼠标位置
      mymenu.style.top = showTop + "px";
      mymenu.style.display = 'block';
      if (mouseClientY + menuHeight  + 100 > screenHeight) {
        menuMusicCard.style.marginTop = '-150px';
      } else {
        menuMusicCard.style.marginTop = '';
      }
      if (mouseClientX + menuWidth  + 110 > screenWidth) {
        menuMusicCard.style.marginLeft = '-100px';
      } else {
        menuMusicCard.style.marginLeft = '110px';
      }
      return false; // 该行代码确保系统自带的右键菜单不会被调出
    }
    function hideMenu() {
      document.getElementById('menu-div').style.display = 'none';
    }
    function menuCopy() {
      document.execCommand("Copy");
    }
  </script>
<% } %>
